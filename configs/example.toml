# Proxmox VE Config — EXAMPLE
# Copy this file and customize for your server.
# Used by: pve-install-hetzner.sh, pve-harden.sh, pve-network.sh

# ══════════════════════════════════════════════════════════════
#  INSTALLER — used by pve-install-hetzner.sh only
# ══════════════════════════════════════════════════════════════

[server]
hostname = "pve1"
fqdn = "pve1.example.com"
timezone = "UTC"
country = "us"
keyboard = "en-us"
iso_url = "https://enterprise.proxmox.com/iso/proxmox-ve_9.1-1.iso"

[network]
interface = "enp7s0"
source = "from-dhcp"
dns1 = "185.12.64.1"
dns2 = "185.12.64.2"
search_domain = "example.com"

[disk]
filesystem = "zfs"
zfs_raid = "raid1"
disk_list = ["/dev/nvme0n1", "/dev/nvme1n1"]

[users]
email = "admin@example.com"
root_password = ""

# ══════════════════════════════════════════════════════════════
#  HARDENING — used by pve-harden.sh
# ══════════════════════════════════════════════════════════════

[hardening]
permit_root_login = "prohibit-password"
ssh_port = 22
zfs_arc_min_gb = 6
zfs_arc_max_gb = 12
smart_warn_temp = 50
smart_crit_temp = 70
smtp_relay_host = "[smtp-relay.brevo.com]:587"
smtp_user = ""
smtp_key = ""
notification_from = ""
notification_email = ""
notification_author = "Proxmox pve1"
firewall_tcp_ports = [22]
firewall_allow_icmp = true
firewall_default_in = "DROP"
f2b_bantime = 3600
f2b_findtime = 600
f2b_maxretry = 3
conntrack_max = 1048576
conntrack_tcp_timeout = 28800

# ══════════════════════════════════════════════════════════════
#  NAT — used by pve-network.sh
#  Private bridge for VMs with outbound internet via masquerade
# ══════════════════════════════════════════════════════════════

[nat]
enabled = true
bridge = "vmbr1"
address = "10.10.10.1/24"      # Host gateway on the NAT bridge
upstream = "vmbr0"              # WAN-facing bridge (masquerade target)
dns1 = "1.1.1.1"               # For cloud-init / reference
dns2 = "8.8.8.8"

# ══════════════════════════════════════════════════════════════
#  TEMPLATE — used by vm-template.sh
#  Cloud image VM template with Docker + optimizations baked in
# ══════════════════════════════════════════════════════════════

[template]
vmid = 9000
name = "debian-docker-tpl"
image_url = "https://cloud.debian.org/images/cloud/trixie/daily/latest/debian-13-genericcloud-amd64-daily.qcow2"
disk_size = "64G"
storage = "local-zfs"
cores = 2
memory = 4096
cloud_init_user = "root"
cloud_init_dns = "1.1.1.1"
ssh_keys_url = ""
optimize_script = "https://github.com/yurrosh/proxmox-utils-hetzner/raw/main/scripts/vm-optimize.sh"
# Template bakes in: OVMF UEFI, virtio VGA, serial0 emergency console,
# tablet=0, balloon=0, fstrim agent, io_uring+no-cache on scsi0

# ══════════════════════════════════════════════════════════════
#  VM — used by vm-clone.sh
#  Production VM cloned from template
# ══════════════════════════════════════════════════════════════

[vm]
vmid = 101
name = "prod-main"
memory = 65536
cores = 16
disk_size = "512G"
ip = "10.10.10.11/24"
hotplug = "disk,network"
balloon = 0
start_after_clone = true

# ── Production VM tuning (applied by vm-clone.sh) ──
numa = 1                  # NUMA topology — beneficial for many-core VMs
allow_ksm = 0             # No memory dedup — dedicated hardware
net_queues = 4            # Multiqueue virtio-net
disk_aio = "io_uring"     # Async I/O backend — optimal for ZFS on NVMe
disk_cache = "none"       # No host cache — ZFS ARC handles caching
cipassword = ""           # Cloud-init password for console login (set per deploy)

# ══════════════════════════════════════════════════════════════
#  TWEAKS — performance optimizations (pve-harden.sh)
# ══════════════════════════════════════════════════════════════

[tweaks]
tcp_bbr = true
tcp_fastopen = true
cpu_governor = "performance"
kernel_panic_reboot = 10
install_pigz = true
vzdump_ionice = 2
vzdump_bwlimit = 0
journal_max_size = "512M"
fs_inotify_max_user_watches = 1048576
fs_inotify_max_user_instances = 512
fs_file_max = 2097152
disable_ha_services = true
nag_removal_method = "dpkg-hook"
install_dark_theme = false
tune_ksm = true
optimize_logrotate = true
